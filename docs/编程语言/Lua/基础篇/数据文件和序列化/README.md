# 数据文件和序列化

在处理数据文件时，写数据通常比读数据要简单的多。当向一个文件中写时，我们拥有绝对的控制权。但是，当从一个文件中读时，我们并不知道会读到什么东西。一个健壮的程序除了能够处理一个合法文件中所包含的所有类型的数据外，还应该能够优雅的处理错误的文件。因此，编写一个健壮的处理输入的程序总是比较困难的。

`Lua` 语言自 `1933` 年发布以来，其主要用途之一就是描述数据。在那个年代，主要的文本数据描述语言之一是 `SGML` 。对于很多人来说， `SGML` 即臃肿又复杂。在 `1998` 年，有些人将其简化成了 `XML` ，但以我们的眼光看仍然臃肿又复杂。有些人跟我们的观点一致，进而在 `2001` 年开发了 `JSON` 。 `JSON` 是基于 `JavaScript` ，类似于一种精简过的 `Lua` 语言数据文件。一方面， `JSON` 的一大优势在于它是**国际标准**，包括 `Lua` 语言在内的多种语言都具有操作 `JSON` 文件的标准库。另一方面， `Lua` 语言数据文件的读取更加容易和灵活。

使用一门全功能的编程语言来描述数据确实非常灵活，但也会带来两个问题。问题之一在于**安全性**，这是因为“数据”文件能够肆意地在我们的程序中运行。我们可以通过在**沙盒**中运行程序来解决这个问题。另一个问题是**性能**问题。 `Lua` 语言不仅运行的快，编译也很快。例如，在测试环境下（我也不知道什么环境。。。）， `Lua5.3` 可以在 `4` 秒以内，占用 `240MB` 内存，完成 `100` 万条赋值语句的读取、编译和运行。作为对比， `Perl 5.18` 需要 `21` 秒，占用 `6GB` 内存， `Python2.7` 和 `Python3.4` 直接崩溃， `Node.js 0.10.25` 在运行 `8` 秒后抛出“**内存溢出**( `out of memory` )”异常， `Rhino 1.7` 在运行 `6` 分钟后也抛出了“**内存溢出**”异常。
